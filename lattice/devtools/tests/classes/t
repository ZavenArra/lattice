<?
Class ObjectRolesTest extends Kohana_UnitTest_TestCase {


	public function testAtlantaExists(){
	}

	/**
	 * @depends testAtlantaExists
	 */
	public function testAddCampaignUserHasLinkage(){
		$mine = ORM::Factory('object');

		$users = self::$atlantaMarket->latticeChildrenQuery()->objectTypeFilter('campaignUsers')->find();
		$usersList = $users->latticeChildrenQuery()->objectTypeFilter('campaignUsersList')->find();
		$userObjectId = $usersList->addObject('campaignUser', array('username'=>time()));	
		$userObject = Graph::object($userObjectId);

		$userCampaigns = $userObject->campaigns->find_all();
		$this->assertTrue(count($userCampaigns)==1);
		return $userCampaigns[0];
	}

	/**
	 * @depends testAddCampaignUserHasLinkage
	 */
	public function testAddCampaignUserCorrectLinkage($userCampaign){
		$this->assertTrue($userCampaign->loaded());
		$this->assertEquals(self::$atlantaMarket->contentDriver()->getContentColumn(self::$atlantaMarket, 'id'), $userCampaign->id);
	}
}
